services:
  main:
    image: nginx:1.29-alpine
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost"]
      interval: 1s
      timeout: 2s
      retries: 30
      start_period: 0s

  optional:
    image: alpine:3.20
    command: ["sh", "-c", "sleep 300"]
    profiles: ["opt"]
    healthcheck:
      test: ["CMD", "true"]
      interval: 1s
      timeout: 1s
      retries: 3
      start_period: 0s
