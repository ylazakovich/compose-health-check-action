services:
  db:
    image: busybox:1.36
    command: >
      sh -c "
        echo 'DB starting...';
        sleep 6;
        echo 'DB healthy (simulated)';
        touch /tmp/ready;
        tail -f /dev/null
      "
    healthcheck:
      test: ["CMD-SHELL", "test -f /tmp/ready"]
      interval: 1s
      timeout: 1s
      retries: 60
      start_period: 0s

  api:
    image: busybox:1.36
    depends_on:
      db:
        condition: service_healthy
    command: >
      sh -c "
        echo 'API starting (requires DB healthy)...';
        sleep 1;
        echo 'API healthy (simulated)';
        touch /tmp/ready;
        tail -f /dev/null
      "
    healthcheck:
      test: ["CMD-SHELL", "test -f /tmp/ready"]
      interval: 1s
      timeout: 1s
      retries: 60
      start_period: 0s

  web:
    image: busybox:1.36
    depends_on:
      api:
        condition: service_healthy
    command: >
      sh -c "
        echo 'WEB starting (requires API healthy)...';
        sleep 1;
        echo 'WEB healthy (simulated)';
        touch /tmp/ready;
        tail -f /dev/null
      "
    healthcheck:
      test: ["CMD-SHELL", "test -f /tmp/ready"]
      interval: 1s
      timeout: 1s
      retries: 60
      start_period: 0s
