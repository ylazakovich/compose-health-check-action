services:
  db:
    image: busybox:1.37
    stop_grace_period: 1s
    command: >
      sh -c "
        echo 'DB starting...';
        echo 'DB healthy (simulated)';
        touch /tmp/ready;
        exec tail -f /dev/null
      "
    healthcheck:
      test: ["CMD-SHELL", "test -f /tmp/ready"]
      interval: 200ms
      timeout: 200ms
      retries: 50
      start_period: 0s

  api:
    image: busybox:1.37
    stop_grace_period: 1s
    depends_on:
      db:
        condition: service_healthy
    command: >
      sh -c "
        echo 'API starting (requires DB healthy)...';
        echo 'API healthy (simulated)';
        touch /tmp/ready;
        exec tail -f /dev/null
      "
    healthcheck:
      test: ["CMD-SHELL", "test -f /tmp/ready"]
      interval: 200ms
      timeout: 200ms
      retries: 50
      start_period: 0s

  web:
    image: busybox:1.37
    stop_grace_period: 1s
    depends_on:
      api:
        condition: service_healthy
    command: >
      sh -c "
        echo 'WEB starting (requires API healthy)...';
        echo 'WEB healthy (simulated)';
        touch /tmp/ready;
        exec tail -f /dev/null
      "
    healthcheck:
      test: ["CMD-SHELL", "test -f /tmp/ready"]
      interval: 200ms
      timeout: 200ms
      retries: 50
      start_period: 0s
